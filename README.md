## 主要功能
* 建立通讯通道。
* 创建登录页面，完成登录逻辑。

## 架构设计
* 运行逻辑：在用户手动登录前，先与后台的前置服务器建立好连接。连接建立好后，让用户进行手动登录。
* 页面设计：通过继承space-pen设计完成。
* 通讯模式：父进程与子进程共同负责通讯，子进程只负责直接与前置服务器通讯，父进程完成各个package的展示交互功能。父进程将数据请求发送给子进程，子进程与后台交互，得到数据后，发送给父进程直接接收数据的接口，再将其发送给各个请求的接收端。

## 主要文档说明
### main.coffee
* package的入口， 在activate中创建由login-view.coffee设计的页面,完成package的功能。

### login-view.coffee
实现package的所有功能。
* 初始化全局变量：这些挂载在window的全局变量在不同的package中都可以使用，主要用于通讯。
    * SysUserApiStruct.js: 规定了请求和回调的数据结构
    * Events.js: 规定请求与回调的事件名称,通讯是基于事件请求的，每次的请求接受数据都有对应的事件名称。
    * window-requestid.js: 标记每个请求的全局唯一的ID，由于每个请求接口可以请求多次，所以不同顺序的请求需要通过请求ID进行识别。
    * client-main.js: 建立后台通讯的主要脚本，提供请求与回调的接口，userApi。
* 页面设计：通过继承space-pen View来实现，采用了bootstrap框架中的模态对话框组件。
* 登录建立：接受到前置连接成功事件后，发出登录请求；收到登录回调数据后，判断是否登录成功，若是成功则发出登录成功消息给treeView 模块，进入到建立treeView的工作中。


### client-main.js
* 功能：创建与后台直接通讯的子进程，提供各个模块与子进程通讯的接口。
* 设计：设计clientMain类型完成功能，最后输出一个对象共全局使用。
    * childProcess: 用于和后台直接通讯的子进程的句柄，通过fork API创建。结构上是nodejs process 对象。进程间的通讯无法像 EventEmitter同时自定义事件名与数据，通讯时发送方直接发送数据，接收方通过监听"message"接收数据。所以子父进程通讯时需要将请求与回调的事件与数据字段打包后一起发送。
    * emitter: 用于和package进行通讯的句柄，结构上是EventEmitter 对象，遵循基于事件的消息分发机制。
    * 通讯过程: 
        * 各个package使用全局对象的emitter属性发送请求，并注册对应的回调函数接受后台回复的数据，请求与回调的事件名称依据请求回调类型而定，全部规定在Event.js中。 
        * emitter接收到请求后，将请求事件名称与请求数据字段封装好，由childProcess属性发送给子进程。
        * 子进程接收到父进程传输的数据后，解析数据包。分析出对应的事件名后调动对应的API发送请求字段给后台。子进程收到后台回复的数据后，将回复的事件名与数据打包发送给父进程。
        * childProcess 属性监听"message", 接收到子进程发送的数据包后，解析其中的回调事件名与数据，通过emitter属性发送给各个请求的package。

### client-child.js
* 功能：父进程与后台通讯的桥梁， 通过进程间通讯的api与父进程通讯，通过封装后的.node二进制文件与后台通讯。
* 设计：主体是user对象，通过对其添加相关的属性完成所有功能；
    * user 主要属性：
        * userApi: 封装c++通讯库后的二进制文件.node 创建的与后台通讯的API.
        * Spi: 响应后台回复数据的回调接口，在server-spi.js有定义，通过userApi.RegisterSpi()注册进入后台通讯库，后台回复数据时，直接调用Spi的回调函数。
        * 这两个属性对应的C++代码在封装代码中可以找到。
    * 通讯过程：
        * 通过子进程的process对象，监听父进程发送的请求，解析请求的事件名和数据字段，通过事件名映射，得到对应的请求函数，直接调用进行请求。请求与事件名之间的映射预先定义好。
        * 后台回复数据后，直接调用Spi中定义的回调函数，在回调函数中打包回复的数据和事件名通过process发送给父进程。

